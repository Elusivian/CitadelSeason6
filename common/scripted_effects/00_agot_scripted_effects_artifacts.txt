agot_add_artifact_history = {
	if = {
		limit = {
			current_date >= $DATE$
		}

		$ARTIFACT$ = {
			add_artifact_history = {
				type = $TYPE$
				date = $DATE$
				recipient = $RECIPIENT$
			}
		}
	}
}

agot_generate_random_link_types_effect = {
	# Top scope is character forging link
	# I create a varibale list because in some cases I want to give an option
	# between a few link types - example in the visit university activity
	random_list = {

		#Black Iron, Ravenry, Diplomacy
		50 = {
			trigger = {
				# Prevents adding more than 2 links of a kind to a chain
				# I check for the chain too to leave open the possibility of
				# Maesters visiting the citadel in the future to form an extra link
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = black_iron_links
								var:black_iron_links = 2
							}
						}
					}
				}
				# Checks that the link is not already in the list of link choices
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:black_iron
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_black_iron
			}
			modifier = { # can probably make scripted modifiers
				factor = 1.5
				var:link_inclination ?= flag:diplomacy
			}
			modifier = {
				add = diplomacy
			}
			modifier = {
				factor = 1.5
				has_trait = diplomat
			}
			modifier = {
				factor = 1.25
				has_trait = reclusive
			}
			add_to_variable_list = {
				name = link_types
				target = flag:black_iron
			}
		}
		#Brass, Geneologies, Diplomacy
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = brass_links
								var:brass_links >= 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:brass
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_brass
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:diplomacy
			}
			modifier = {
				add = diplomacy
			}
			modifier = {
				factor = 2
				has_trait = family_first
			}
			modifier = {
				factor = 1.5
				has_trait = diplomat
			}
			add_to_variable_list = {
				name = link_types
				target = flag:brass
			}
		}
		#Bronze, Astronomy, Learning
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = bronze_links
								var:bronze_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:bronze
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_bronze
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:learning
			}
			modifier = {
				add = learning
			}
			modifier = {
				factor = 1.5
				has_trait = scholar
			}
			add_to_variable_list = {
				name = link_types
				target = flag:bronze
			}
		}
		#Copper, History, Learning
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = copper_links
								var:copper_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:copper
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_copper
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:learning
			}
			modifier = {
				add = learning
			}
			modifier = {
				factor = 1.5
				has_trait = scholar
			}
			add_to_variable_list = {
				name = link_types
				target = flag:copper
			}
		}
		#Electrum, Cyphers, Intrigue
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = electrum_links
								var:electrum_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:electrum
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_electrum
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:intrigue
			}
			modifier = {
				add = intrigue
			}
			modifier = {
				factor = 1.5
				has_trait = schemer
			}
			modifier = {
				factor = 1.25
				OR = {
					has_trait = deceitful
					has_trait = paranoid
				}
			}
			modifier = {
				factor = 0.75
				OR = {
					has_trait = honest
					has_trait = trusting
				}
			}
			add_to_variable_list = {
				name = link_types
				target = flag:electrum
			}
		}
		#Yellow Gold, Money
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = yellow_gold_links
								var:yellow_gold_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:yellow_gold
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_yellow_gold
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:stewardship
			}
			modifier = {
				add = stewardship
			}
			modifier = {
				add = learning
			}
			modifier = {
				factor = 1.5
				has_trait = administrator
			}
			modifier = {
				factor = 1.25
				has_trait = greedy
			}
			modifier = {
				factor = 0.75
				has_trait = generous
			}
			add_to_variable_list = {
				name = link_types
				target = flag:yellow_gold
			}
		}
		#Red Gold, Mathematics, Learning
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = red_gold_links
								var:red_gold_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:red_gold
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_red_gold
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:learning
			}
			modifier = {
				add = learning
			}
			modifier = {
				factor = 1.5
				has_trait = theologian # Or scholar?
			}
			add_to_variable_list = {
				name = link_types
				target = flag:red_gold
			}
		}
		#Iron, Warcraft, Martial
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = iron_links
								var:iron_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:iron
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_iron
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:martial
			}
			modifier = {
				add = martial
			}
			modifier = {
				factor = 1.5
				has_trait = theologian # Or scholar?
			}
			modifier = {
				factor = 1.25
				OR = {
					has_trait = calm
					has_trait = patient
				}
			}
			modifier = {
				factor = 0.75
				OR = {
					has_trait = wrathful
					has_trait = impatient
				}
			}
			add_to_variable_list = {
				name = link_types
				target = flag:iron
			}
		}
		#Lead, Poisons, Intrigue
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = lead_links
								var:lead_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:lead
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_lead
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:intrigue
			}
			modifier = {
				add = intrigue
			}
			modifier = {
				factor = 1.5
				OR = {
					has_trait = schemer
					has_trait = torturer
					has_trait = lifestyle_herbalist
				}
			}
			modifier = {
				factor = 1.25
				OR = {
					has_trait = vengeful
					has_trait = deceitful
				}
				has_trait = deceitful
			}
			modifier = {
				factor = 0.75
				OR = {
					has_trait = forgiving
					has_trait = honest
				}
				has_trait = deceitful
			}
			add_to_variable_list = {
				name = link_types
				target = flag:lead
			}
		}
		#Pewter, Architecture, Stewardship
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = pewter_links
								var:pewter_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:pewter
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_pewter
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:stewardship
			}
			modifier = {
				add = stewardship
			}
			modifier = {
				factor = 1.5
				has_trait = architect
			}
			add_to_variable_list = {
				name = link_types
				target = flag:pewter
			}
		}
		#Platinum, Agricultural Studies, Stewardship
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = platinum_links
								var:platinum_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:platinum
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_platinum
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:stewardship
			}
			modifier = {
				add = stewardship
			}
			modifier = {
				factor = 1.5
				OR = {
					has_trait = lifestyle_gardener
					has_trait = lifestyle_herbalist
				}
			}
			add_to_variable_list = {
				name = link_types
				target = flag:platinum
			}
		}
		#Silver, Healing, Learning
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = silver_links
								var:silver_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:silver
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_silver
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:learning
			}
			modifier = {
				add = learning
			}
			modifier = {
				factor = 1.5
				has_trait = lifestyle_physician
			}
			modifier = {
				factor = 1.25
				has_trait = compassionate
			}
			add_to_variable_list = {
				name = link_types
				target = flag:silver
			}
		}
		#Steel, Metalurgy, Martial
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = steel_links
								var:steel_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:steel
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_steel
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:martial
			}
			modifier = {
				add = martial
			}
			modifier = {
				add = prowess
			}
			add_to_variable_list = {
				name = link_types
				target = flag:steel
			}
		}
		#Tin, Diplomacy, Languages
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = tin_links
								var:tin_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:tin
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_tin
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:diplomacy
			}
			modifier = {
				factor = 1.5
				has_trait = diplomat
			}
			modifier = {
				factor = 2
				num_of_known_languages > 1
			}
			modifier = {
				add = diplomacy
			}
			add_to_variable_list = {
				name = link_types
				target = flag:tin
			}
		}
		#Bismuth, Faiths, Learning
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = bismuth_links
								var:bismuth_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:bismuth
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_bismuth
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:learning
			}
			modifier = {
				add = learning
			}
			modifier = {
				factor = 1.5
				has_trait = theologian
			}
			modifier = {
				factor = 1.25
				has_trait = zealous
			}
			modifier = {
				factor = 0.75
				has_trait = cynical
			}
			add_to_variable_list = {
				name = link_types
				target = flag:bismuth
			}
		}
		#Cast Iron, Husbandry, Stewardship
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = cast_iron_links
								var:cast_iron_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:cast_iron
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_cast_iron
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:stewardship
			}
			modifier = {
				add = stewardship
			}
			modifier = {
				factor = 0.5
				has_trait = cannibal
			}
			add_to_variable_list = {
				name = link_types
				target = flag:cast_iron
			}
		}
		#Antimony, Geography, Diplomacy
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = antimony_links
								var:antimony_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:antimony
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_antimony
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:diplomacy
			}
			modifier = {
				add = diplomacy
			}
			add_to_variable_list = {
				name = link_types
				target = flag:antimony
			}
		}
		#Nickel, Alchemical Studies, Intrigue
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = nickel_links
								var:nickel_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:nickel
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_nickel
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:intrigue
			}
			modifier = {
				add = intrigue
			}
			modifier = {
				factor = 1.5
				OR = {
					has_trait = schemer
					has_trait = torturer
					has_trait = lifestyle_herbalist
				}
			}
			add_to_variable_list = {
				name = link_types
				target = flag:nickel
			}
		}
		#White Copper, Poli Sci, Intrigue
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = white_copper_links
								var:white_copper_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:white_copper
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_white_copper
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:intrigue
			}
			modifier = {
				add = intrigue
			}
			modifier = {
				factor = 1.5
				OR = {
					has_trait = schemer
					has_trait = diplomat
				}
			}
			modifier = {
				factor = 1.25
				has_trait = gregarious
			}
			modifier = {
				factor = 0.75
				has_trait = shy
			}
			add_to_variable_list = {
				name = link_types
				target = flag:white_copper
			}
		}
		#Aluminum, Logistics, Martial
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = aluminum_links
								var:aluminum_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:aluminum
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_aluminum
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:martial
			}
			modifier = {
				add = martial
			}
			modifier = {
				factor = 1.5
				has_trait = strategist
			}
			modifier = {
				factor = 1.25
				OR = {
					has_trait = temperate
					has_trait = calm
					has_trait = patient
				}
			}
			modifier = {
				factor = 0.75
				OR = {
					has_trait = wrathful
					has_trait = impatient
				}
			}
			add_to_variable_list = {
				name = link_types
				target = flag:aluminum
			}
		}
		#Zinc, Engineering, Martial
		50 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = zinc_links
								var:zinc_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:zinc
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_zinc
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:martial
			}
			modifier = {
				add = martial
			}
			modifier = {
				factor = 1.5
				has_trait = architect
			}
			add_to_variable_list = {
				name = link_types
				target = flag:zinc
			}
		}
		#Valyrian Steel, Higher Mysteries, Learning
		10 = {
			trigger = {
				NOT = {
					any_character_artifact = {
						AND = {
							OR = {
								artifact_type = maester_link_collection
								artifact_type = maester_chain
							}
							AND = {
								has_variable = vs_links
								var:vs_links = 2
							}
						}
					}
				}
				NOT = {
					is_target_in_variable_list = {
						name = link_types
						target = flag:vs
					}
				}
			}
			modifier = {
				factor = 1000
				has_inactive_trait = archmaester_vs
			}
			modifier = {
				factor = 1.5
				var:link_inclination ?= flag:learning
			}
			modifier = {
				add = learning
			}
			modifier = {
				factor = 2
				OR = {
					has_trait = dragon_dreams
					has_trait = greensight
				}
			}
			modifier = {
				factor = 1.5
				has_trait = lifestyle_mystic
			}
			modifier = {
				factor = 1.25
				OR = {
					has_trait = ambitious
					has_trait = stubborn
				}
			}
			modifier = {
				factor = 0.75
				OR = {
					has_trait = content
				}
			}
			add_to_variable_list = {
				name = link_types
				target = flag:vs
			}
		}

	}
}

agot_set_artifact_link_rarity = {
	if = {
		limit = {
			scope:owner = {
				var:link_type ?= flag:vs
			}
		}
		save_scope_value_as = {
			name = quality
			value = 100
		}
		save_scope_value_as = {
			name = wealth
			value = 100
		}
	}
	else_if = {
		limit = {
			scope:owner = {
				exists = var:link_type
			}
		}

		save_scope_value_as = {
			name = quality
			value = 15
		}
		save_scope_value_as = {
			name = wealth
			value = 15
		}
	}
}

agot_artifact_link_set_modifiers = {

	if = {
		limit = {
			exists = scope:owner.var:link_type
		}

		switch = {
			trigger = scope:owner.var:link_type
			flag:black_iron = { add_artifact_modifier = artifact_diplomacy_1_stacking_modifier }
			flag:brass = { add_artifact_modifier = artifact_diplomacy_1_stacking_modifier }
			flag:bronze = { add_artifact_modifier = artifact_learning_1_stacking_modifier }
			flag:copper = { add_artifact_modifier = artifact_learning_1_stacking_modifier }
			flag:electrum = { add_artifact_modifier = artifact_intrigue_1_stacking_modifier }
			flag:yellow_gold = { add_artifact_modifier = artifact_stewardship_1_stacking_modifier }
			flag:red_gold = { add_artifact_modifier = artifact_learning_1_stacking_modifier }
			flag:iron = { add_artifact_modifier = artifact_martial_1_stacking_modifier }
			flag:lead = { add_artifact_modifier = artifact_intrigue_1_stacking_modifier }
			flag:pewter = { add_artifact_modifier = artifact_stewardship_1_stacking_modifier }
			flag:platinum = { add_artifact_modifier = artifact_stewardship_1_stacking_modifier }
			flag:silver = { add_artifact_modifier = artifact_learning_1_stacking_modifier }
			flag:steel = { add_artifact_modifier =artifact_martial_1_stacking_modifier }
			flag:tin = { add_artifact_modifier = artifact_diplomacy_1_stacking_modifier }
			flag:bismuth = { add_artifact_modifier = artifact_learning_1_stacking_modifier }
			flag:cast_iron = { add_artifact_modifier = artifact_stewardship_1_stacking_modifier }
			flag:antimony = { add_artifact_modifier = artifact_diplomacy_1_stacking_modifier }
			flag:nickel = { add_artifact_modifier = artifact_intrigue_1_stacking_modifier }
			flag:white_copper = { add_artifact_modifier = artifact_intrigue_1_stacking_modifier }
			flag:aluminum = { add_artifact_modifier = artifact_martial_1_stacking_modifier }
			flag:zinc = { add_artifact_modifier = artifact_martial_1_stacking_modifier }
			flag:vs = {
				add_artifact_modifier = artifact_learning_1_stacking_modifier
				add_artifact_modifier = artifact_learning_1_stacking_modifier
			}
		}
	}
}

agot_artifact_link_set_count = {
	if = {
		limit = {
			exists = scope:owner.var:link_type
		}

		switch = {
			trigger = scope:owner.var:link_type
			flag:black_iron = {
				if = {
					limit = {
						has_variable = black_iron_links
					}

					change_variable = {
						name = black_iron_links
						add = 1
					}

				}
				else = {
					set_variable = {
						name = black_iron_links
						value = 1
					}
				}
			}
			flag:brass = {
				if = {
					limit = {
						has_variable = brass_links
					}
					change_variable = {
						name = brass_links
						add = 1
					}
				}
				else = {
					set_variable = {
						name = brass_links
						value = 1
					}
				}
			}
			flag:bronze = {
				if = {
					limit = {
						has_variable = bronze_links
					}
					change_variable = {
						name = bronze_links
						add = 1
					}
				}
				else = {
					set_variable = {
						name = bronze_links
						value = 1
					}
				}
			}
			flag:copper = {
				if = {
					limit = {
						has_variable = copper_links
					}

					change_variable = {
						name = copper_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = copper_links
						value = 1
					}

				}
			}
			flag:electrum = {
				if = {
					limit = {
						has_variable = electrum_links
					}

					change_variable = {
						name = electrum_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = electrum_links
						value = 1
					}

				}
			}
			flag:yellow_gold = {
				if = {
					limit = {
						has_variable = yellow_gold_links
					}

					change_variable = {
						name = yellow_gold_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = yellow_gold_links
						value = 1
					}

				}
			}
			flag:red_gold = {
				if = {
					limit = {
						has_variable = red_gold_links
					}

					change_variable = {
						name = red_gold_links
						add = 1
					}


				}
				else = {

					set_variable = {
						name = red_gold_links
						value = 1
					}

				}
			}
			flag:iron = {
				if = {
					limit = {
						has_variable = iron_links
					}

					change_variable = {
						name = iron_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = iron_links
						value = 1
					}

				}
			}
			flag:lead = {
				if = {
					limit = {
						has_variable = lead_links
					}

					change_variable = {
						name = lead_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = lead_links
						value = 1
					}

				}
			}
			flag:pewter = {
				if = {
					limit = {
						has_variable = pewter_links
					}

					change_variable = {
						name = pewter_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = pewter_links
						value = 1
					}

				}
			}
			flag:platinum = {
				if = {
					limit = {
						has_variable = platinum_links
					}

					change_variable = {
						name = platinum_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = platinum_links
						value = 1
					}

				}
			}
			flag:silver = {
				if = {
					limit = {
						has_variable = silver_links
					}

					change_variable = {
						name = silver_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = silver_links
						value = 1
					}

				}
			}
			flag:steel = {
				if = {
					limit = {
						has_variable = steel_links
					}

					change_variable = {
						name = steel_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = steel_links
						value = 1
					}

				}
			}
			flag:tin = {
				if = {
					limit = {
						has_variable = tin_links
					}

					change_variable = {
						name = tin_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = tin_links
						value = 1
					}

				}
			}
			flag:bismuth = {
				if = {
					limit = {
						has_variable = bismuth_links
					}

					change_variable = {
						name = bismuth_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = bismuth_links
						value = 1
					}

				}
			}
			flag:cast_iron = {
				if = {
					limit = {
						has_variable = cast_iron_links
					}

					change_variable = {
						name = cast_iron_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = cast_iron_links
						value = 1
					}

				}
			}
			flag:antimony = {
				if = {
					limit = {
						has_variable = antimony_links
					}

					change_variable = {
						name = antimony_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = antimony_links
						value = 1
					}

				}
			}
			flag:nickel = {
				if = {
					limit = {
						has_variable = nickel_links
					}

					change_variable = {
						name = nickel_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = nickel_links
						value = 1
					}

				}
			}
			flag:white_copper = {
				if = {
					limit = {
						has_variable = white_copper_links
					}

					change_variable = {
						name = white_copper_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = white_copper_links
						value = 1
					}

				}
			}
			flag:aluminum = {
				if = {
					limit = {
						has_variable = aluminum_links
					}

					change_variable = {
						name = aluminum_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = aluminum_links
						value = 1
					}

				}
			}
			flag:zinc = {
				if = {
					limit = {
						has_variable = zinc_links
					}

					change_variable = {
						name = zinc_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = zinc_links
						value = 1
					}

				}
			}
			flag:vs = {
				if = {
					limit = {
						has_variable = vs_links
					}

					change_variable = {
						name = vs_links
						add = 1
					}

				}
				else = {

					set_variable = {
						name = vs_links
						value = 1
					}

				}
			}
		}
	}
}

#To be used on an artifact to set the archmaester regalia
#For keeping track of archmaester history
agot_artifact_archmaester_set_specialty_effect = {
	scope:owner = {
		switch = {
			trigger = has_inactive_trait
			archmaester_black_iron = {
				prev = {
					set_variable = { name = specialty value = flag:black_iron }
					add_artifact_modifier = artifact_diplomacy_1_stacking_modifier
				}
			}
			archmaester_brass = {
				prev = {
					set_variable = { name = specialty value = flag:brass }
					add_artifact_modifier = artifact_diplomacy_1_stacking_modifier
				}
			}
			archmaester_bronze = {
				prev = {
					set_variable = { name = specialty value = flag:bronze }
					add_artifact_modifier = artifact_learning_1_stacking_modifier
				}
			}
			archmaester_copper = {
				prev = {
					set_variable = { name = specialty value = flag:copper }
					add_artifact_modifier = artifact_learning_1_stacking_modifier
				}
			}
			archmaester_electrum = {
				prev = {
					set_variable = { name = specialty value = flag:electrum }
					add_artifact_modifier = artifact_intrigue_1_stacking_modifier
				}
			}
			archmaester_yellow_gold = {
				prev = {
					set_variable = { name = specialty value = flag:yellow_gold }
					add_artifact_modifier = artifact_stewardship_1_stacking_modifier
				}
			}
			archmaester_red_gold = {
				prev = {
					set_variable = { name = specialty value = flag:red_gold }
					add_artifact_modifier = artifact_learning_1_stacking_modifier
				}
			}
			archmaester_iron = {
				prev = {
					set_variable = { name = specialty value = flag:iron }
					add_artifact_modifier = artifact_martial_1_stacking_modifier
				}
			}
			archmaester_lead = {
				prev = {
					set_variable = { name = specialty value = flag:lead }
					add_artifact_modifier = artifact_intrigue_1_stacking_modifier
				}
			}
			archmaester_pewter = {
				prev = {
					set_variable = { name = specialty value = flag:pewter }
					add_artifact_modifier = artifact_stewardship_1_stacking_modifier
				}
			}
			archmaester_platinum = {
				prev = {
					set_variable = { name = specialty value = flag:platinum }
					add_artifact_modifier = artifact_stewardship_1_stacking_modifier
				}
			}
			archmaester_silver = {
				prev = {
					set_variable = { name = specialty value = flag:silver }
					add_artifact_modifier = artifact_learning_1_stacking_modifier
				}
			}
			archmaester_steel = {
				prev = {
					set_variable = { name = specialty value = flag:steel }
					add_artifact_modifier =artifact_martial_1_stacking_modifier
				}
			}
			archmaester_tin = {
				prev = {
					set_variable = { name = specialty value = flag:tin }
					add_artifact_modifier = artifact_diplomacy_1_stacking_modifier
				}
			}
			archmaester_bismuth = {
				prev = {
					set_variable = { name = specialty value = flag:bismuth }
					add_artifact_modifier = artifact_learning_1_stacking_modifier
				}
			}
			archmaester_cast_iron = {
				prev = {
					set_variable = { name = specialty value = flag:cast_iron }
					add_artifact_modifier = artifact_stewardship_1_stacking_modifier
				}
			}
			archmaester_antimony = {
				prev = {
					set_variable = { name = specialty value = flag:antimony }
					add_artifact_modifier = artifact_diplomacy_1_stacking_modifier
				}
			}
			archmaester_nickel = {
				prev = {
					set_variable = { name = specialty value = flag:nickel }
					add_artifact_modifier = artifact_intrigue_1_stacking_modifier
				}
			}
			archmaester_white_copper = {
				prev = {
					set_variable = { name = specialty value = flag:white_copper }
					add_artifact_modifier = artifact_intrigue_1_stacking_modifier
				}
			}
			archmaester_aluminum = {
				prev = {
					set_variable = { name = specialty value = flag:aluminum }
					add_artifact_modifier = artifact_martial_1_stacking_modifier
				}
			}
			archmaester_zinc = {
				prev = {
					set_variable = { name = specialty value = flag:zinc }
					add_artifact_modifier = artifact_martial_1_stacking_modifier
				}
			}
			archmaester_vs = {
				prev = {
					set_variable = { name = specialty value = flag:vs }
					add_artifact_modifier = artifact_learning_1_stacking_modifier
					add_artifact_modifier = artifact_learning_1_stacking_modifier
				}
			}
		}
	}

	add_artifact_modifier = artifact_learning_1_stacking_modifier
}

agot_dragon_birth_magic_effect = {
	if = {
		limit = {
			any_living_dragon = {
				count = 1
			}
		}
		set_global_variable = {
			name = magic_level
			value = 1
		}

		agot_update_glass_candles_effect = yes
	}
	else_if = {
		limit = {
			any_living_dragon = {
				count = 10
			}
			NOT = { global_var:magic_level = 2 }
		}
		set_global_variable = {
			name = magic_level
			value = 2
		}
		agot_update_glass_candles_effect = yes
	}
}

agot_dragon_death_magic_effect = {
	if = {
		limit = { # I don't know if the dragon is still counted as alive, but it looks like it
			any_living_dragon = {
				NOT = { this = root }
				count = 0
			}
		}
		set_global_variable = {
			name = magic_level
			value = 0
		}
		agot_update_glass_candles_effect = yes
	}
	else_if = {
		limit = {
			any_living_dragon = {
				NOT = { this = root }
				count < 9
			}
			NOT = { global_var:magic_level = 1 }
		}
		set_global_variable = {
			name = magic_level
			value = 1
		}
		agot_update_glass_candles_effect = yes
	}
	else_if = {
		limit = {
			NOT = { global_var:magic_level = 2 }
		}
		set_global_variable = {
			name = magic_level
			value = 2
		}
		agot_update_glass_candles_effect = yes
	}
}

agot_update_glass_candles_effect = {
	every_glass_candle = {
		save_scope_as = newly_created_artifact
		switch = {
			trigger = has_artifact_feature
			glass_candle_black = { save_scope_value_as = { name = candle_color value = flag:black } }
			glass_candle_green = { save_scope_value_as = { name = candle_color value = flag:green } }
			glass_candle_blue = { save_scope_value_as = { name = candle_color value = flag:blue } }
			glass_candle_purple = { save_scope_value_as = { name = candle_color value = flag:purple } }
			glass_candle_white = { save_scope_value_as = { name = candle_color value = flag:white } }
			glass_candle_red = { save_scope_value_as = { name = candle_color value = flag:red } }
		}
		if = {
			limit = {
				artifact_type = pedestal
			}
			reforge_artifact = {
				type = pedestal
				visuals = glass_candle
				description = agot_artifact_glass_candle_desc
				modifier = glass_candle_modifier
				generate_history = no
			}
		}
		else = {
			reforge_artifact = {
				type = glass_candle
				description = agot_artifact_glass_candle_desc
				modifier = glass_candle_modifier
				generate_history = no
			}
		}
	}
}

agot_create_random_glass_candle_effect = {
	random_list = {
		1 = {
			agot_create_artifact_glass_candle_effect = { OWNER = $OWNER$ COLOR = black }
		}
		1 = {
			agot_create_artifact_glass_candle_effect = { OWNER = $OWNER$ COLOR = green }
		}
		1 = {
			agot_create_artifact_glass_candle_effect = { OWNER = $OWNER$ COLOR = blue }
		}
		1 = {
			agot_create_artifact_glass_candle_effect = { OWNER = $OWNER$ COLOR = purple }
		}
		1 = {
			agot_create_artifact_glass_candle_effect = { OWNER = $OWNER$ COLOR = white }
		}
		1 = {
			agot_create_artifact_glass_candle_effect = { OWNER = $OWNER$ COLOR = red }
		}
	}
	scope:newly_created_artifact = {
		save_scope_as = epic #for adventure inspiration loc
	}
}