
rv_rescue_war_story = {

	on_setup = {
		
	}

	on_end = {

	}

	on_owner_death = {
		end_story = yes
	}
}

rv_rescue_war_defender_story = {

	on_setup = {
		
	}

	on_end = {

	}

	on_owner_death = {
		if = {
			limit = {exists = story_owner.player_heir }
			make_story_owner = story_owner.player_heir
		}
		else = { end_story = yes }
	}

	effect_group = {
		days = { 30 90 }

		triggered_effect = {
			trigger = {
				story_owner = {
					is_ai = yes
				}
			}

			effect = {
				story_owner = {
					save_scope_as = defender
				}
	
				every_in_list = {
					variable = rv_attacking_rescuers
					save_scope_as = attacker
					random = {
						chance = 0
						modifier = {
							add = rv_rescue_war_defender_release_score
							exists = scope:attacker
						}
						opinion_modifier = {
							opinion_target = scope:attacker
							who = scope:defender
							multiplier = 0.1
						}
						modifier = {
                            add = 5
                            scope:defender = {
                                dread_modified_ai_boldness = {
                                    dreaded_character = scope:attacker
                                    value <= 0
                                }
                            }
                        }
						modifier = {
                            add = 10
                            scope:defender = {
                                dread_modified_ai_boldness = {
                                    dreaded_character = scope:attacker
                                    value <= -40
                                }
                            }
                        }
						modifier = {
							add = {
								value = scope:defender.ai_rationality
								multiply = -0.2
								max = 0
							}
							rv_attacker_military_strength < rv_defender_military_strength
						}
						modifier = {
							add = {
								value = scope:defender.ai_rationality
								multiply = 0.1
								min = 5
							}
							rv_attacker_military_strength > rv_defender_military_strength_mult
						}
						modifier = {
							add = {
								value = scope:defender.ai_rationality
								multiply = 0.2
								min = 10
							}
							rv_attacker_military_strength > rv_defender_military_strength_mult_2
						}
						modifier = {
							factor = {
								value = scope:defender.ai_rationality
								divide = 66
								min = 1
							}
							rv_attacker_military_strength > rv_defender_military_strength_mult
						}
						modifier = {
							factor = {
								value = scope:defender.ai_rationality
								divide = 66
								min = 1
							}
							rv_attacker_military_strength > rv_defender_military_strength_mult_2
						}
						scope:attacker = {
							random_owned_story = {
								limit = { 
									story_type = rv_rescue_war_story 
									has_variable_list = rv_currently_rescuing
								}
								every_in_list = {
									variable = rv_currently_rescuing
									limit = {
										is_alive = yes
										is_imprisoned_by = scope:defender
									}
									release_from_prison = yes
								}
							}
						}
					}
				}
			}
		}
	}
}

rv_revenge_war_story = {

	on_setup = {
		
	}

	on_end = {

	}

	on_owner_death = {
		end_story = yes
	}
}

rv_revenge_war_defender_story = {

	on_setup = {
		
	}

	on_end = {

	}

	on_owner_death = {
		end_story = yes
	}
}
