secret_identity_story = {
	on_setup = {
		story_owner = { add_character_flag = secret_adventure_ongoing }
	}

	on_end = {}

	on_owner_death = {
		scope:story = { end_story = yes }
	}

	### DAILY
	effect_group = {
		days = 1

		#Checking if the story is still valid
		triggered_effect = {
			trigger = {
				story_owner = {
					OR = {
						NOT = { has_character_flag = generic_secret_identity }
						NOT = { is_alive = yes }
						NOT = { agot_can_be_ruler = yes }
					}
				}
			}
			effect = {
				scope:story = { end_story = yes }
			}
		}
	}

	### MONTHLY
	effect_group = {
		months = 1

		#Adventure - Living under a secret identity - Decision in 1-4 years (~2.5 years on average)
		triggered_effect = {
			trigger = {
				story_owner = {
					is_adult = yes
					has_character_flag = generic_secret_identity
					has_character_flag = secret_adventure_ongoing
					is_alive = yes
					agot_can_be_ruler = yes
					exists = var:secret_adventure_chance
					var:secret_adventure_chance > 0
				}
			}
			effect = {
				story_owner = { save_scope_as = secret_child }
				scope:secret_child = {
					random_list = {
						100 = {
							change_variable = {
								name = secret_adventure_chance
								subtract = 1
							}
						}
						25 = {
							change_variable = {
								name = secret_adventure_chance
								subtract = 2
							}
						}
						5 = {
							change_variable = {
								name = secret_adventure_chance
								subtract = 3
							}
						}
						1 = {
							change_variable = {
								name = secret_adventure_chance
								subtract = 50
							}
						}
					}
				}
			}
		}
		#Deceision ahead - StayLow\Reveal\War\Adventure
		triggered_effect = {
			trigger = {
				story_owner = {
					is_adult = yes
					has_character_flag = generic_secret_identity
					has_character_flag = secret_adventure_ongoing
					is_alive = yes
					agot_can_be_ruler = yes
					exists = var:secret_adventure_chance
					var:secret_adventure_chance < 1
				}
			}
			effect = {
				story_owner = { save_scope_as = secret_child }
				scope:secret_child = {
					if = {
						limit = { has_variable = secret_adventure_chance }
						remove_variable = secret_adventure_chance
					}
					if = {
						limit = { has_character_flag = secret_adventure_ongoing }
						remove_character_flag = secret_adventure_ongoing
					}
					agot_secret_identity_adventure_effect = yes
				}
			}
		}
	}

	### YEARLY
	effect_group = {
		years = 1

		#Waiting to become an adult
		triggered_effect = {
			trigger = {
				story_owner = {
					is_adult = yes
					has_character_flag = generic_secret_identity
					has_character_flag = secret_adventure_ongoing
					is_alive = yes
					agot_can_be_ruler = yes
					NOT = { has_character_flag = secret_child_is_adult }
				}
			}
			effect = {
				story_owner = { save_scope_as = secret_child }
				scope:secret_child = {
					if = {
						limit = { has_variable = secret_adventure_chance }
						remove_variable = secret_adventure_chance
					}
					set_variable = {
						name = secret_adventure_chance
						value = 50
					}
					add_character_flag = secret_child_is_adult
				}
			}
		}
	}
}