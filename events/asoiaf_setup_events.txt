namespace = asoiaf_setup_events

asoiaf_setup_events.1 = {
	type = character_event
	hidden = yes
	
	immediate = {
		vassal_contract_set_obligation_level = {
			type = council_rights
			level = 0 #council_rights_none
		}
		vassal_contract_set_obligation_level = {
			type = war_declaration_rights
			level = 0 #war_declaration_rights_default
		}
	}
}

asoiaf_setup_events.2 = { #for some reason a random CoA is generated on game start, instead of using the base CoA
	type = character_event
	hidden = yes
	
	immediate = {
		title:d_kingsguard = {
			set_coa = d_kingsguard
		}
		title:b_the_citadel = {
			set_coa = b_the_citadel
		}
		house:house_Essos = { #Young Griff's temp House during his reconquest
			set_coa = dynn_Targaryen
		}
	}
}

asoiaf_setup_events.5 = { #Destroys the vanilla AGOT version of Robert I's crown
	type = character_event
	hidden = yes
	
	immediate = {
		every_character_artifact = {
			limit = { has_variable = robertI_crown_artifact }
			save_scope_as = this_artifact
		}
		destroy_artifact = scope:this_artifact
	}
}

asoiaf_setup_events.6 = {
	type = character_event
	hidden = yes
	
	immediate = {
		vassal_contract_set_obligation_level = {
			type = special_contract
			level = 2 #special_contract_march #to replace palatinate
		}
	}
}

asoiaf_setup_events.7 = { #NPK Rhaegar birth event
	type = character_event
	hidden = yes
	
	immediate = {
		dynasty:dynn_Targaryen = {
			every_dynasty_member = {
				limit = {
					AND = {
						father ?= character:Targaryen_1 #Aerys
						mother ?= character:Targaryen_2 #Rhaella
						is_male = yes
						has_trait = beauty_good_3
						has_trait = intellect_good_2
					}
				}
				if = {
					limit = {
						asoiaf_canon_children_enabled_trigger = yes
						NOT = { has_inactive_trait = asoiaf_Targaryen_3_trait } #necessary to stop duplicating the stats; the trait is assigned immediately after
					}
					add_character_modifier = asoiaf_Targaryen_3_modifier
					add_martial_skill = 6
					add_diplomacy_skill = 8
					add_intrigue_skill = 5
					add_stewardship_skill = 9
					add_learning_skill = 9
					add_prowess_skill = 8
				}
				make_trait_inactive = asoiaf_Targaryen_3_trait
				if = {
					limit = {
						NOT = { exists = global_var:asoiaf_canon_children_Targaryen_3_born_variable } #necessary to stop duplicating the artefacts; the variable is assigned immediately after
					}
					create_artifact_asoiaf_rhaegars_sword_effect = { OWNER = this }
					agot_create_artifact_rhaegars_armour_effect = { OWNER = this }
				}
				set_global_variable = asoiaf_canon_children_Targaryen_3_born_variable
				add_character_flag = has_scripted_appearance
				if = {
					limit = { has_game_rule = asoiaf_new_dnas_valyrian_rule_on }
					copy_inheritable_appearance_from = character:Targaryen_asoiaf_3
					make_trait_inactive = cool_silver_hair
					make_trait_inactive = purple_eyes_6
				}

				set_sexuality = heterosexual
				
				if = {
					limit = { has_game_rule = asoiaf_canon_children_rule_on_traits }
					add_trait = diligent
					add_trait = calm
					add_trait = brave
					add_trait = ambitious
					add_trait = lifestyle_blademaster
					add_trait = depressed_1
					add_trait = poet
					add_trait = education_martial_prowess_3
					add_trait = tourney_participant
					add_trait_xp = {
						trait = tourney_participant
						track = horse
						value = 70
					}
					add_trait_xp = {
						trait = tourney_participant
						track = foot
						value = 50
					}
					
					set_focus = education_learning
					add_perk = pedagogy_perk
					add_perk = open_minded_perk
					add_perk = apostate_perk
					add_perk = scientific_perk
					add_perk = planned_cultivation_perk
					add_perk = scholarly_circles_perk
					add_perk = learn_on_the_job_perk
					add_perk = sanctioned_loopholes_perk
					add_perk = scholar_perk
					add_perk = stalwart_leader_perk
					add_perk = chivalric_dominance_perk
					add_perk = never_back_down_perk
				}
			}
		}
	}
}

asoiaf_setup_events.8 = { #removes the dragonrider modifier from House Brightflame with a delay
	type = character_event
	hidden = yes
	
	immediate = {
		house:house_Brightflame ?= { remove_house_modifier = dragonrider_house_modifier }
	}
}

asoiaf_setup_events.9 = { #equips scoped artefacts with a delay
	type = character_event
	hidden = yes
	
	immediate = {
		every_character_artifact = {
			limit = { has_variable = kingsguard_sword_artifact }
			save_scope_as = this_artifact
		}
		destroy_artifact = scope:this_artifact
		asoiaf_equip_jaimes_sword_artefact_effect = yes
	}
}

asoiaf_setup_events.10 = { #fixes post-history effect changes
	type = character_event
	hidden = yes
	
	immediate = {
		character:Velaryon_43 ?= { #Addam Velaryon (bastard of Corlys)
			if = {
				limit = { father ?= character:Velaryon_35 } #Laenor set as his father
				set_father = character:Velaryon_31 #Corlys Velaryon (the Sea Snake)
			}
		}
		character:Velaryon_44 ?= { #Alyn Velaryon (bastard of Corlys)
			if = {
				limit = { father ?= character:Velaryon_35 } #Laenor set as his father
				set_father = character:Velaryon_31 #Corlys Velaryon (the Sea Snake)
			}
		}
		character:Truefyre_1 ?= { #Trystane Truefyre
			if = {
				limit = { real_father ?= character:Targaryen_60 } #Viserys I Targaryen
				set_real_father = character:asoiaf_Truefyre_father
			}
		}
		character:Targaryen_75 ?= { #Jacaerys Velaryon (son of Rhaenyra)
			asoiaf_clear_inherited_traits_effect = yes
			add_trait = beauty_good_3
			add_trait = intellect_good_1
			if = {
				limit = {
					has_trait = strong
				}
				remove_trait = strong
			}
		}
		character:Targaryen_76 ?= { #Lucerys Velaryon (son of Rhaenyra)
			asoiaf_clear_inherited_traits_effect = yes
			add_trait = beauty_good_1
			if = {
				limit = {
					has_trait = strong
				}
				remove_trait = strong
			}
		}
		character:Targaryen_77 ?= { #Joffrey Velaryon (son of Rhaenyra)
			asoiaf_clear_inherited_traits_effect = yes
			if = {
				limit = {
					has_trait = strong
				}
				remove_trait = strong
			}
		}
	}
}