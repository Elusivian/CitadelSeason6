namespace = agot_small_council

# Invite the target to the small council
#	widget = {
#		gui = "event_window_widget_enter_text"
#		container = "dynamic_birth_name"
#		controller = {
#			type = text
#			data = {
#				key = small_council_title
#				default = {
#					localization_key = master_of_coin
#					trigger = {scope:secondary_recipient = {is_male = yes}}
#				}
#				default = {
#					localization_key = lady_of_coin
#					trigger = {scope:secondary_recipient = {is_female = yes}}
#				}
#				default = {
#					localization_key = master_of_ships
#					trigger = {scope:secondary_recipient = {is_male = yes}}
#				}
#				default = {
#					localization_key = lady_of_ships
#					trigger = {scope:secondary_recipient = {is_female = yes}}
#				}
#			}
#		}
#		setup_scope = {
#			scope:secondary_recipient = { save_scope_as = text_target }
#		}
#	}

agot_small_council.0001 = {
	theme = court
	title = agot_small_council.0001.t
	desc = agot_small_council.0001.desc
	left_portrait = root
	right_portrait = scope:secondary_recipient
	lower_center_portrait = scope:recipient
	option = {
		name = agot_small_council.0001.a #castellan
		trigger = {
			trigger_if = {
				limit = { exists = cp:councillor_castellan  }
				cp:councillor_castellan  = {
					can_be_fired_from_council_trigger = { COURT_OWNER = root }
					}
			}
		}
		scope:secondary_recipient = {
			set_variable = {
				name = castellan
				value = 0
			}
		}
		hire_small_councillor = yes
		scope:recipient = {
			small_councillor_vassal_repatriation_effect = yes
		}
	}
	option = {
		name = agot_small_council.0001.b #chancellor thanks demand_poet
		trigger = {
			trigger_if = {
				limit = { exists = cp:councillor_chancellor }
				cp:councillor_chancellor = {
					can_be_fired_from_council_trigger = { COURT_OWNER = root }
					}
			}
		}
		scope:secondary_recipient = {
			set_variable = {
				name = chancellor
				value = 0
			}
		}
		hire_small_councillor = yes
		scope:recipient = {
			small_councillor_vassal_repatriation_effect = yes
		}
	}
	option = {
		name = agot_small_council.0001.c #steward
		trigger = {
			trigger_if = {
				limit = { exists = cp:councillor_steward }
				cp:councillor_steward = {
					can_be_fired_from_council_trigger = { COURT_OWNER = root }
					}
			}
		}
		scope:secondary_recipient = {
			set_variable = {
				name = steward
				value = 0
			}
		}
		hire_small_councillor = yes
		scope:recipient = {
			small_councillor_vassal_repatriation_effect = yes
		}
	}
	option = {
		name = agot_small_council.0001.d #marshal
		trigger = {
			trigger_if = {
				limit = { exists = cp:councillor_marshal }
				cp:councillor_marshal = {
					can_be_fired_from_council_trigger = { COURT_OWNER = root }
					}
			}
			scope:secondary_recipient = {
				can_be_marshal_trigger = { COURT_OWNER = root }
			}
		}
		scope:secondary_recipient = {
			set_variable = {
				name = marshal
				value = 0
			}
		}
		hire_small_councillor = yes
		scope:recipient = {
			small_councillor_vassal_repatriation_effect = yes
		}
	}
	option = {
		name = agot_small_council.0001.e #admiral
		trigger = {
			trigger_if = {
				limit = { exists = cp:councillor_admiral }
				cp:councillor_admiral = {
					can_be_fired_from_council_trigger = { COURT_OWNER = root }
					}
			}
			scope:secondary_recipient = {
				can_be_admiral_trigger = { COURT_OWNER = root }
			}
		}
		scope:secondary_recipient = {
			set_variable = {
				name = admiral
				value = 0
			}
		}
		hire_small_councillor = yes
		scope:recipient = {
			small_councillor_vassal_repatriation_effect = yes
		}
	}
	option = {
		name = agot_small_council.0001.f #spymaster
		trigger = {
			trigger_if = {
				limit = { exists = cp:councillor_spymaster }
				cp:councillor_spymaster = {
					can_be_fired_from_council_trigger = { COURT_OWNER = root }
					}
			}
		}
		scope:secondary_recipient = {
			set_variable = {
				name = spymaster
				value = 0
			}
		}
		hire_small_councillor = yes
		scope:recipient = {
			small_councillor_vassal_repatriation_effect = yes
		}
	}
	option = {
		name = agot_small_council.0001.g #this dude a dummy
	}
	after = {
		small_councillor_appointment_effect = yes
	}
}

agot_small_council.0002 = {
	hidden = yes

	trigger = {
		exists = var:small_council
	}

	immediate = {
		liege = { remove_relation_small_councillor = root }
		fire_small_councillor = yes
	}
}

agot_small_council.0003 = {
	type = letter_event
	opening = {
		desc = agot_small_council.1.opening
	}
	desc = agot_small_council.0003.desc
	sender = scope:recipient

	#Accept
	option = {
		name = agot_small_council.0003.a
		custom_tooltip = agot_small_council.0003.a.tt

		pay_short_term_gold = {
			target = scope:recipient
			gold = demand_conversion_bribe_size
		}
		scope:actor = {
			trigger_event = agot_small_council.0001
		}
		hidden_effect = {
			scope:recipient = {
				add_truce_both_ways = {
					character = scope:secondary_recipient
					days = 36500
					name = TRUCE_ENFORCE_TRUCE
				}
			}
		}
		stress_impact = {
			greedy = medium_stress_impact_gain
		}
		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_greed = -1
				ai_zeal = 0.5
			}
			modifier = {
				factor = 0.2
				gold <= 0
			}
		}
	}

	#Refuse
	option = {
		name = agot_small_council.0003.b
		add_opinion = {
			target = scope:recipient
			modifier = refused_vassal_appointment_opinion
		}

		ai_chance = {
			base = 10
			modifier = {
				add = 100
				gold < demand_conversion_bribe_size
			}
		}
	}

	#Use a Hook to force it through
	option = {
		name = agot_small_council.0003.c
		trigger = {
			has_strong_usable_hook = scope:recipient
		}
		use_hook = scope:recipient

		scope:actor = {
			trigger_event = agot_small_council.0001
		}
		hidden_effect = {
			scope:recipient = {
				add_truce_both_ways = {
					character = scope:secondary_recipient
					days = 36500
					name = TRUCE_ENFORCE_TRUCE
				}
			}
		}
		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_rationality = 1
			}
		}
	}
}

agot_small_council.0004 = {
	type = letter_event
	opening = {
		desc = agot_small_council.1.opening
	}
	desc = agot_small_council.0004.desc
	sender = scope:recipient

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					exists = scope:recipient.capital_county
					scope:recipient.capital_county.faith = scope:recipient.faith
				}
				save_scope_value_as = {
					name = convert_capital
					value = yes
				}
			}
		}
		scope:recipient = {
			add_opinion = {
				modifier = demanded_my_vassal_opinion
				target = root
			}
		}
	}

	#Accept
	option = {
		name = agot_small_council.0004.a
		scope:recipient = {
			if = { # Check that they don't already have a hook on root
				limit = {
					NOT = {
						has_hook_of_type = {
							target = root
							type = favor_hook
						}
					}
				}
				add_hook = {
					target = root
					type = favor_hook
				}
			}
		}
		scope:actor = {
			trigger_event = agot_small_council.0001
		}
		hidden_effect = {
			scope:recipient = {
				add_truce_both_ways = {
					character = scope:secondary_recipient
					days = 36500
					name = TRUCE_ENFORCE_TRUCE
				}
			}
		}
		stress_impact = {
			greedy = medium_stress_impact_gain
		}
		ai_chance = {
			base = 100
		}
	}

	#Refuse
	option = {
		name = agot_small_council.0004.b
		add_opinion = {
			target = scope:recipient
			modifier = refused_vassal_appointment_opinion
		}
		ai_chance = {
			base = 10
		}
	}

	#Use a Hook to force it through
	option = {
		name = agot_small_council.0004.c
		trigger = {
			has_strong_usable_hook = scope:recipient
		}
		use_hook = scope:recipient
		scope:actor = {
			trigger_event = agot_small_council.0001
		}
		hidden_effect = {
			scope:recipient = {
				add_truce_both_ways = {
					character = scope:secondary_recipient
					days = 36500
					name = TRUCE_ENFORCE_TRUCE
				}
			}
		}
		ai_chance = {
			base = 100
			ai_value_modifier = {
				ai_rationality = 1
			}
		}
	}
}

agot_small_council.0005 = {
	type = letter_event
	opening = {
		desc = agot_small_council.1.opening
	}
	desc = agot_small_council.0005.desc
	sender = scope:recipient

	immediate = {
	}

	#Accept
	option = {
		name = agot_small_council.0005.a
	}

}
