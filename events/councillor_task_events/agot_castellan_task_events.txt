
#Events related to the Castellan's tasks

namespace = castellan_task


scripted_trigger specialised_castellan = {
	OR = {
		has_variable = martial_castellan
		has_variable = diplomacy_castellan
		has_variable = learning_castellan
		has_variable = intrigue_castellan
		has_variable = stewardship_castellan
	}
}

castellan_task.1001 = { #button reset for player castellans
	hidden = yes

	trigger = {
		exists = cp:councillor_castellan
	}

	immediate = {
		cp:councillor_castellan = {
			save_scope_as = active_councillor
		}

		scope:active_councillor = {
			remove_variable = martial_castellan
			remove_variable = diplomacy_castellan
			remove_variable = learning_castellan
			remove_variable = intrigue_castellan
			remove_variable = stewardship_castellan
			start_default_task = yes
		}
	}
}

castellan_task.1002 = { # reset for ai castellan
	hidden = yes

	trigger = {
		is_ai = yes
	}

	immediate = {
		if = {
			limit = {
				exists = liege_or_court_owner
				liege_or_court_owner = { is_ai = yes }
			}
			remove_variable = martial_castellan
			remove_variable = diplomacy_castellan
			remove_variable = learning_castellan
			remove_variable = intrigue_castellan
			remove_variable = stewardship_castellan
			if = {
				limit = {
					is_councillor = yes
				}
				start_default_task = yes
			}
		}
	}

	after = {
		if = {
			limit = {
				exists = liege_or_court_owner
				liege_or_court_owner = { is_ai = yes }
			}
			remove_variable = martial_castellan
			remove_variable = diplomacy_castellan
			remove_variable = learning_castellan
			remove_variable = intrigue_castellan
			remove_variable = stewardship_castellan
			if = {
				limit = {
					is_councillor = yes
				}
				start_default_task = yes
			}
		}
	}
}

