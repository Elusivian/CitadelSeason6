namespace = agot_citadel_maintenance

# Remove all women from court / The begone thots event
agot_citadel_maintenance.0001 = {
	hidden = yes

	immediate = {
		global_var:citadel_title.holder = {
			every_courtier_or_guest = {
				limit = { is_female = yes }

				if = {
					limit = {
						has_trait = maester
					}
					remove_trait = maester
					random_character_artifact = {
						limit = {
							OR = {
								artifact_type = maester_link
								artifact_type = maester_chain
								artifact_type = maester_link_collection
							}
						}
						destroy_artifact = this
					}
				}
				set_employer = title:d_oldtown.holder
			}
		}
	}
}

###init the citadel
agot_citadel_maintenance.0003 = {
	hidden = yes
	type = character_event

	immediate = {
		every_courtier = {
			limit = {
				is_human = yes
				is_male = yes
				age >= 8
			}
			if = {
				limit = {
					NOT = {
						has_trait = maester
					}
				}
				add_trait = maester
			}
			if = {
				limit = {
					NOT = {
						has_character_flag = blocked_from_leaving
					}
				}

				add_character_flag = blocked_from_leaving
			}
			if = {
				limit = {
					NOT = {
						any_owned_story = { story_type = story_maester }
					}
				}
				create_story = story_maester
			}
		}

		agot_seed_acolytes_effect = yes
	}
}

#Incase we do pruning
# agot_citadel_maintenance.0100 = {
#     hidden = yes

# 	immediate = {
# 		agot_random_maester_death_effect = yes
# 	}
# }

# Novices and Acolytes get up to three chain links per year
agot_citadel_maintenance.0101 = {
	hidden = yes

	immediate = {
		random_list = {
			pick = 3
			150 = {
				trigger = {
					has_trait_xp = {
						trait = maester
						value < 100
					}
				}
				modifier = {
					factor = 1.5
					has_trait_rank = {
						trait = intellect_good
						rank > 0
					}
				}
				modifier = {
					factor = 0.5
					has_trait_rank = {
						trait = intellect_bad
						rank > 0
					}
				}
				modifier = {
					factor = 1.25
					OR = {
						has_trait = inquisitive
					}
				}
				modifier = {
					factor = 1.15
					OR = {
						has_trait = diligent
						has_trait = ambitious
					}
				}
				modifier = {
					factor = 0.5
					OR = {
						has_trait = lazy
						has_trait = impatient
					}
				}
				# I seperate them out through the year for two reasons
				# 1. It makes more sense
				# 2. When triggered at the same time we run into issues
				trigger_event = {
					id = agot_maester.0003
					days = { 1 364 }
				}
			}
			150 = {

			}
		}
	}
}