namespace = agot_filler_rhllor

#####################
# The Lord of Light #
#####################

agot_filler_rhllor.0001 = { # A Red Priestess appears at court
	type = character_event
	title = agot_filler_rhllor.0001.t
	desc = agot_filler_rhllor.0001.desc
	theme = learning_theology_focus
	override_background = {
		reference = temple
	}

	left_portrait = {
		character = root
		animation = boredom
	}

	right_portrait = {
		character = scope:red_priestess
		animation = personality_zealous
	}

	trigger = {
		is_available_adult = yes
		is_landed = yes
		capital_county = {
			is_coastal_county = yes
		}
		NOR = {
			has_religion = religion:rhllor_religion
			has_character_flag = red_priest_recruit_attempt
		}
	}

	immediate = {
		add_character_flag = red_priest_recruit_attempt

		if = {
			limit = {
				AND = {
					exists = character:Melisandre_1
					exists = character:Baratheon_3
					character:Melisandre_1 = {
						is_alive = yes
					}
					root = {
						this = character:Baratheon_3
					}
				}
			}
			hidden_effect = {
				character:Melisandre_1 = {
					add_trait = devoted # Red Priestess
					add_trait = fire_obsessed
					add_trait = lifestyle_mystic
					add_trait_xp = {
						trait = lifestyle_mystic
						value = trait_third_level
					}
					save_scope_as = red_priestess
					set_character_faith = faith:red_god
				}
			}
			hidden_effect = {
				root = {
					add_courtier ?= scope:red_priestess
				}
			}
		}

		else = {
			create_character = {
				age = { 18 30 }
				random_culture = {
					culture:essosi_valyrian = { }
					culture:volantene = { }
					culture:lyseni = { }
					culture:pentoshi = { }
					culture:myrish = { }
				}
				gender_female_chance = 100
				dynasty = none
				faith = faith:red_god
				employer = root
				random_traits = yes
				trait = devoted
				trait = fire_obsessed
				random_traits_list = {
					education_learning_1 = { weight = { base = 20 } }
					education_learning_2 = { weight = { base = 20 } }
					education_learning_3 = { weight = { base = 45 } }
					education_learning_4 = { weight = { base = 15 } }
				}
				save_scope_as = red_priestess
				after_creation = {
					add_character_flag = portrait_kissed_by_fire
					if = {
						limit = { has_trait = dwarf }
						remove_trait = dwarf
					}
					if = {
						limit = { has_trait = clubfooted }
						remove_trait = clubfooted
					}
				}

			}
		}
	}


	option = {	# Welcome her to court, but make no promises
		name = agot_filler_rhllor.0001.a

		ai_chance = {
			base = 0
			modifier = {
				root = { this = character:Baratheon_3 }
				add = agot_historic_outcome_5
			}
			modifier = {
				NOT = { root = { this = character:Baratheon_3 } }
				add = 70
			}
		}
	}

	option = {	# I shall embrace this new faith!
		name = agot_filler_rhllor.0001.b
		custom_tooltip = {
			text = agot_filler_rhllor.0001.b.tt
		}
		add_piety = 250
		set_character_faith = faith:red_god
		if = {
			limit = {
				dynasty = dynasty:dynn_Baratheon
			}
			set_house = house:house_BaratheonDS
			every_child = {
				set_character_faith = faith:red_god
				set_house = house:house_BaratheonDS
				every_child = {
					set_house = house:house_BaratheonDS
				}
			}
			every_held_title = {
				set_coa = root.house
			}
		}
		every_spouse = {
			set_character_faith = faith:red_god
		}

		ai_chance = {
			base = 0
			modifier = {
				has_trait = cynical
				add = 20
			}
			modifier = {
				root = { this = character:Baratheon_3 }
				add = agot_nonhistoric_outcome_5
			}
		}
	}

	option = {	# I shall embrace this new faith... and more besides
		name = agot_filler_rhllor.0001.c
		add_piety = 250
		set_character_faith = faith:red_god
		trigger = {
			root = {
				is_attracted_to_gender_of = scope:red_priestess
			}
			scope:red_priestess = {
				is_attracted_to_gender_of = root
			}
		}
		if = {
			limit = {
				dynasty = dynasty:dynn_Baratheon
			}
			set_house = house:house_BaratheonDS
			every_child = {
				set_character_faith = faith:red_god
				set_house = house:house_BaratheonDS
				every_child = {
					set_house = house:house_BaratheonDS
				}
			}
			every_held_title = {
				set_coa = root.house
			}
		}
		set_relation_lover = {
			target = scope:red_priestess
			reason = lover_deviant
		}

		ai_chance = {
			base = 0
			modifier = {
				has_trait = cynical
				has_trait = lustful
				add = 10
			}
			modifier = {
				root = { this = character:Baratheon_3 }
				add = agot_nonhistoric_outcome_5
			}
		}
	}

	option = {	# Begone, witch!
		name = agot_filler_rhllor.0001.d
		scope:red_priestess = {
			agot_banish_effect = { BANISHER = root }
		}
		ai_chance = {
			base = 0
			modifier = {
				has_trait = zealous
				add = 100
			}
			modifier = {
				root = { this = character:Baratheon_3 }
				add = agot_nonhistoric_outcome_5
			}
		}
	}

	option = {	# Execute this woman at once!
		name = agot_filler_rhllor.0001.e
		add_dread = 10
		scope:red_priestess = {
			death = { death_reason = death_execution killer = root }
		}

		ai_chance = {
			base = 0
			modifier = {
				AND = {
					has_trait = zealous
					has_trait = callous
				}
				add = 100
			}
			modifier = {
				root = { this = character:Baratheon_3 }
				add = agot_nonhistoric_outcome_5
			}
		}
	}
}

agot_filler_rhllor.0002 = { # Rhllor based Personal CoA
	type = character_event
	title = agot_filler_rhllor.0002.t
	desc = agot_filler_rhllor.0002.desc
	theme = martial
	override_background = {
		reference = bp1_bonfire
	}

	right_portrait = {
		character = root
		animation = war_attacker
	}

	trigger = {
		is_lowborn = no
		is_adult = yes
		is_alive = yes
		OR = {
			has_faith = faith:red_god
			has_faith = faith:rhllor
		}
		NOT = { has_character_flag = has_personal_coa }
		agot_is_valid_dyn_coa_target = yes
		has_rhllor_personal_coa_trigger = yes
	}

	option = {
		name = agot_filler_rhllor.0002.a

		hidden_effect = {
			agot_create_personal_coa = yes
		}

		ai_chance = {
			base = 50

			ai_value_modifier = {
				ai_zeal = 1
			}
		}
	}

	option = {
		name = agot_filler_rhllor.0002.b

		ai_chance = {
			base = 50

			modifier = {
				add = 100

				piety_level < 1
			}

			modifier = {
				add = 100

				OR = {
					has_trait = craven
					has_trait = content
				}
			}
		}
	}
}

# 0020 - The Lord of Light Requires a Sacrifice/ Free Cities Conversion
# by: Steelers
agot_filler_rhllor.0020 = {
	type = character_event
	title = agot_filler_rhllor.0020.t
	desc = agot_filler_rhllor.0020.desc
	theme = faith
	override_background = { reference = market }

	right_portrait = {
		character = root
		animation = thinking
	}
	left_portrait = {
		character = scope:red_priest
		animation = chaplain
	}

	cooldown = { years = 20 }

	trigger = {
		is_available_adult = yes
		faith = {
			NOT = { religion = religion:rhllor_religion }
		}
		any_held_county = {
			OR = {
				title_province = { geographical_region = world_essos_lys }
				title_province = { geographical_region = world_essos_myr }
				title_province = { geographical_region = world_essos_tyrosh }
			}
		}
		any_courtier_or_guest = {
			is_human = yes
			NOR = {
				religion = religion:rhllor_religion
				is_close_or_extended_family_of = root
			}
		}
	}

	immediate = {
		random_courtier_or_guest = {
			limit = {
				is_human = yes
				NOR = {
					religion = religion:rhllor_religion
					is_close_or_extended_family_of = root
				}
			}
			save_scope_as = companion
		}
		create_character = {
			location = root.location
			template = agot_red_priest_character
			save_scope_as = red_priest
		}
		location = { save_scope_as = current_location }
	}

	option = {  # Sacrifice your flesh
		name = agot_filler_rhllor.0020.a

		set_character_faith = faith:rhllor
		every_spouse = {
			set_character_faith = faith:rhllor
		}
		every_child = {
			set_character_faith = faith:rhllor
		}
		add_piety = 500
		add_trait = maimed
		add_courtier = scope:red_priest
		every_courtier_or_guest = {
			limit = { faith = faith:rhllor }
			add_opinion = {
				target = root
				modifier = pleased_opinion
				opinion = 40
			}
		}
		stress_impact = {
			zealous = monumental_stress_gain
			sadistic = massive_stress_loss
			lunatic_1 = massive_stress_loss
			lunatic_genetic = massive_stress_loss
		}

		ai_chance = {
			base = 0
		}
	}

	option = {  # Sacrifice your companion
		name = agot_filler_rhllor.0020.b

		set_character_faith = faith:rhllor
		every_spouse = {
			set_character_faith = faith:rhllor
		}
		every_child = {
			set_character_faith = faith:rhllor
		}
		add_piety = 250
		add_courtier = scope:red_priest
		scope:companion = {
			if = {
				limit = { exists = dynasty }
				dynasty = {
					every_dynasty_member = {
						add_opinion = {
							target = root
							modifier = angry_opinion
							opinion = -80
						}
					}
				}
			}
			else = {
				every_close_or_extended_family_member = {
					add_opinion = {
						target = root
						modifier = angry_opinion
						opinion = -80
					}
				}
			}
			death = {
				killer = root
				death_reason = death_sacrificed_to_gods
			}
		}
		every_courtier_or_guest = {
			limit = { faith = faith:rhllor }
			add_opinion = {
				target = root
				modifier = pleased_opinion
				opinion = 40
			}
		}
		stress_impact = {
			zealous = monumental_stress_gain
			compassionate = massive_stress_gain
			just = massive_stress_gain
			sadistic = massive_stress_loss
			lunatic_1 = massive_stress_loss
			lunatic_genetic = massive_stress_loss
		}

		ai_chance = {
			base = 0
		}
	}

	option = {  # I don't think so...
		name = agot_filler_rhllor.0020.c

		add_piety = 50
		add_prestige = -100
		save_scope_as = no_sacrifice

		ai_chance = {
			base = 100
		}
	}

	after = {
		if = {
			limit = { exists = scope:no_sacrifice }
			scope:red_priest = { silent_disappearance_effect = yes }
		}
	}
}


# 0021 - TODO: Attempt to heal disfigurement
