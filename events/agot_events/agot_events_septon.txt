namespace = agot_septon_events

# ##########################################
# # Take septon interaction w/sons
# ##########################################

# agot_septon_events.0001 = {
# 	type = character_event
# 	title = agot_septon_events.0001.t
# 	desc = agot_septon_events.0001.desc

# 	theme = dynasty
# 	override_background = {
# 		reference = throne_room
# 	}

# 	right_portrait = {
# 		character = scope:would_be_septon
# 		animation = personality_honorable
# 	}

# 	trigger = {
# 		is_ruler = yes
# 		faith = faith:the_seven_main
# 		any_child  = {
# 			is_male = yes
# 			age >= 14
# 			has_trait = zealous
# 			is_married = no
# 		}
# 	}


# 	immediate = {
# 		random_child  = {
# 			limit = {
# 				is_male = yes
# 				age >= 14
# 				has_trait = zealous
# 				is_married = no
# 			}

# 			save_scope_as = would_be_septon
# 		}
# 	}

# 	option = { #a septon would be beniefical
# 		name = agot_septon_events.0001.a
# 		if = {
# 			limit = {
# 				scope:would_be_septon = {
# 					OR = {
# 						has_trait = lustful
# 						has_trait = wrathful
# 						has_trait = greedy
# 						has_trait = vengeful
# 					}
# 				}
# 			}
# 			trigger_event = agot_septon_events.0002
# 		}
# 		else = {
# 			trigger_event = agot_septon_events.0003
# 		}
# 	}

# 	option = { #son will not join the faith
# 		name = agot_septon_events.0001.b
# 	}
# }

# agot_septon_events.0002 = { #son refuses
# 	type = character_event
# 	title = agot_septon_events.0002.t
# 	desc = agot_septon_events.0002.desc

# 	theme = dynasty
# 	override_background = {
# 		reference = throne_room
# 	}

# 	right_portrait = {
# 		character = scope:would_be_septon
# 		animation = rage
# 	}

# 	option = { #fine
# 		name = agot_septon_events.0002.a
# 	}
# }

# agot_septon_events.0003 = { #service
# 	type = character_event
# 	title = agot_septon_events.0003.t
# 	desc = agot_septon_events.0003.desc

# 	theme = dynasty
# 	override_background = {
# 		reference = throne_room
# 	}

# 	right_portrait = {
# 		character = scope:would_be_septon
# 		animation = personality_honorable
# 	}

# 	option = { #a speton would be beniefical
# 		name = agot_septon_events.0003.a
# 		trigger_event = agot_septon_events.0004
# 	}
# }

# agot_septon_events.0004 = { #picking patron
# 	type = character_event
# 	title = agot_septon_events.0004.t
# 	desc = agot_septon_events.0004.desc

# 	theme = dynasty
# 	override_background = {
# 		reference = throne_room
# 	}

# 	right_portrait = {
# 		character = scope:would_be_septon
# 		animation = personality_honorable
# 	}

# 	option = { #father
# 		name = agot_septon_events.0004.a
# 		add_character_modifier ={
# 			modifier = patron_the_father_modifier
# 			years = 5
# 		}
# 	}

# 	option = { #mother
# 		name = agot_septon_events.0004.b
# 		add_character_modifier ={
# 			modifier = patron_the_mother_modifier
# 			years = 5
# 		}
# 	}

# 	option = { #warrior
# 		name = agot_septon_events.0004.c
# 		add_character_modifier ={
# 			modifier = patron_the_warrior_modifier
# 			years = 5
# 		}
# 	}

# 	option = { #smith
# 		name = agot_septon_events.0004.d
# 		add_character_modifier ={
# 			modifier = patron_the_smith_modifier
# 			years = 5
# 		}
# 	}

# 	option = { #maiden
# 		name = agot_septon_events.0004.e
# 		add_character_modifier ={
# 			modifier = patron_the_maiden_modifier
# 			years = 5
# 		}
# 	}

# 	option = { #Crone
# 		name = agot_septon_events.0004.f
# 		add_character_modifier ={
# 			modifier = patron_the_crone_modifier
# 			years = 5
# 		}
# 	}

# 	option = { #stranger
# 		name = agot_septon_events.0004.g
# 		add_character_modifier ={
# 			modifier = patron_the_stranger_modifier
# 			years = 5
# 		}
# 	}

# 	after = {
# 		trigger_event = agot_septon_events.0005
# 		scope:would_be_septon = {
# 			add_trait = septon
# 		}
# 	}
# }

# agot_septon_events.0005 = { #service - end
# 	type = character_event
# 	title = agot_septon_events.0005.t
# 	desc = agot_septon_events.0005.desc

# 	theme = dynasty
# 	override_background = {
# 		reference = throne_room
# 	}

# 	right_portrait = {
# 		character = scope:would_be_septon
# 		animation = personality_honorable
# 	}

# 	option = {
# 		name = agot_septon_events.0005.a
# 		add_piety = medium_piety_gain
# 		scope:would_be_septon = {
# 			add_trait = disinherited
# 			move_to_pool = yes
# 		}
# 	}
# }

agot_septon_events.1000 = {
	hidden = yes

	trigger = {
		scope:title = {
			this = title:d_oldtown
		}
		exists = title:k_the_most_devout.holder
		exists = faith.religious_head
		faith.religious_head = title:k_the_most_devout.holder
		NOT = {
			cp:councillor_court_chaplain ?= title:k_the_most_devout.holder
		}
	}

	immediate = {
		title:d_oldtown = {

			create_title_and_vassal_change = {
				type = swear_fealty
				save_scope_as = change
			}
			title:k_the_most_devout.holder = {
				change_liege = {
					liege = title:d_oldtown.holder
					change = scope:change
				}
				resolve_title_and_vassal_change = scope:change
			}

			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = no
			}
			title:b_the_starry_sept = {
				change_title_holder_include_vassals = {
					holder = title:k_the_most_devout.holder
					change = scope:title_change
				}
			}
			resolve_title_and_vassal_change = scope:title_change

			if = {
				limit = {
					exists = cp:councillor_court_chaplain
				}
				set_variable = {
					name = setting_up_high_septon
					value = yes
					days = 1
				}
				fire_councillor = cp:councillor_court_chaplain
			}
			assign_councillor_type = {
				type = councillor_court_chaplain
				target = title:k_the_most_devout.holder
			}
		}
	}
}

agot_septon_events.1001 = {
	hidden = yes

	trigger = {
		has_title = title:d_oldtown
		exists = title:k_the_most_devout.holder
		exists = faith.religious_head
		faith.religious_head = title:k_the_most_devout.holder
		NOT = {
			cp:councillor_court_chaplain ?= title:k_the_most_devout.holder
		}
	}

	immediate = {
		title:d_oldtown.holder = {

			create_title_and_vassal_change = {
				type = swear_fealty
				save_scope_as = change
			}
			title:k_the_most_devout.holder = {
				change_liege = {
					liege = title:d_oldtown.holder
					change = scope:change
				}
				resolve_title_and_vassal_change = scope:change
			}

			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = no
			}
			title:b_the_starry_sept = {
				change_title_holder_include_vassals = {
					holder = title:k_the_most_devout.holder
					change = scope:title_change
				}
			}
			resolve_title_and_vassal_change = scope:title_change

			if = {
				limit = {
					exists = cp:councillor_court_chaplain
				}
				set_variable = {
					name = setting_up_high_septon
					value = yes
					days = 1
				}
				fire_councillor = cp:councillor_court_chaplain
			}
			assign_councillor_type = {
				type = councillor_court_chaplain
				target = title:k_the_most_devout.holder
			}
		}
	}
}