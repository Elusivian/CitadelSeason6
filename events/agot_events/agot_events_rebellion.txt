
##################################################
# 5 Year Pulse Events which exist to create more instabiliy in enormous realms
# agot_instability.1001 - Paramount Declares themselves King
# agot_instability.1100 - Extant Blackfyres Invade
# Skagosi Rebellion
# Sistermen Rebellion
# Reyne Rebellion
# Peake Uprising
# Mountain Clansmen Invade with a King
# Random Mountain Clansmen raid
# Faith Militant
# Defiance of Duskendale

##################################################

namespace = agot_instability

##################################################
# Paramount Declares themselves King - Greyjoy Rebellion / Laughing Storm Rebellion
# Badger
# 1001
##################################################

agot_instability.1001 = {
	hidden = yes

	trigger = {
		#Currently for the Iron Throne as it Stagnates due to its enormity
		primary_title = title:e_the_iron_throne
		is_at_war = no #For now to stop shit
		any_vassal_or_below = {
			is_adult = yes
			is_ai = yes
			is_imprisoned = no
			is_at_war = no
			highest_held_title_tier >= tier_kingdom
			NOT = {
				primary_title = title:k_the_most_devout #fuck off high septon
			}
			#Dislikes the King
			opinion = {
				target = root
				value <= -40
			}
			NOT = {
				root = { #Block Nonsensical Declarations
					OR = {
						is_allied_to = prev
						has_strong_hook = prev
						has_relation_lover = prev
						has_relation_friend = prev
						has_truce = prev
					}
				}
			}
		}
	}

	left_portrait = scope:revolter

	immediate = {
		every_vassal_or_below = {
			limit = {
				is_adult = yes
				is_ai = yes
				is_imprisoned = no
				is_at_war = no
				highest_held_title_tier >= tier_kingdom
				NOT = {
					primary_title = title:k_the_most_devout #fuck off high septon
				}
				#Dislikes the King
				opinion = {
					target = root
					value <= -50
				}
				NOT = {
					root = { #Block Nonsensical Declarations
						OR = {
							is_allied_to = prev
							has_strong_hook = prev
							has_relation_lover = prev
							has_relation_friend = prev
							has_truce = prev
						}
					}
				}
			}
			add_to_list = rebellious_targets
		}
		random_in_list = {
			list = rebellious_targets
			weight = {
				base = 1
				#Weigh up for opinion/strength?
				modifier = {
					add = 10
					primary_title.tier = tier_kingdom
				}
			}
			save_scope_as = revolter
		}

		# ordered_in_list = {
		# 	list = rebellious_targets
		# 	order_by = primary_title.tier
		# 	max = 1

		# 	save_scope_as = revolter
		# }
	}
	option = {
		random_list = {
			99 = {
				#No Revolt
			}
			1 = { #Revolt
				opinion_modifier = { #Weight up Opinion
					who = scope:revolter
					opinion_target = root
					multiplier = -1
				}
				ai_value_modifier = { #Weight up their Boldness
					who = scope:revolter
					ai_boldness = 1
				}
				ai_value_modifier = { #Weight up their Rationality
					who = scope:revolter
					ai_rationality = -0.5
				}
				modifier = {
					scope:revolter = {
						has_character_flag = current_dragon
					}
					add = {
						value = 1
						multiply = 1.5
					}
				}
				scope:revolter = {
					start_war = {
						casus_belli = agot_independence_war
						target = root
					}
					#They declare themselves king - Fix once Megawars allows it
					#trigger_event = agot_proclamation_events.0001
				}
			}
		}
	}
}

##################################################
# 5 Year Pulse - A Claimant begins to gather a host for an attack
# Badger
# 1002
##################################################

# agot_instability.1002 = {
# 	#hidden = yes
# 	orphan = yes
# 	trigger = {
# 		#Currently for the Iron Throne as it Stagnates due to its enormity
# 		primary_title = title:e_the_iron_throne
# 		is_at_war = no #For now to stop shit
# 		any_vassal_or_below = {
# 			is_adult = yes
# 			is_ai = yes
# 			highest_held_title_tier >= tier_kingdom
# 			NOT = {
# 				primary_title = title:k_the_most_devout #fuck off high septon
# 			}
# 			#Dislikes the King
# 			opinion = {
# 				target = root
# 				value <= -40
# 			}
# 			NOT = {
# 				root = { #Block Nonsensical Declarations
# 					OR = {
# 						is_allied_to = prev
# 						has_strong_hook = prev
# 						has_relation_lover = prev
# 						has_relation_friend = prev
# 					}
# 				}
# 			}
# 		}
# 	}

# 	left_portrait = scope:revolter

# 	immediate = {
# 		every_vassal_or_below = {
# 			limit = {
# 				is_adult = yes
# 				is_ai = yes
# 				highest_held_title_tier >= tier_kingdom
# 				NOT = {
# 					primary_title = title:k_the_most_devout #fuck off high septon
# 				}
# 				#Dislikes the King
# 				opinion = {
# 					target = root
# 					value <= -40
# 				}
# 				NOT = {
# 					root = { #Block Nonsensical Declarations
# 						OR = {
# 							is_allied_to = prev
# 							has_strong_hook = prev
# 							has_relation_lover = prev
# 							has_relation_friend = prev
# 						}
# 					}
# 				}
# 			}
# 			add_to_list = rebellious_targets
# 		}
# 		random_in_list = {
# 			list = rebellious_targets
# 			weight = {
# 				base = 1
# 				modifier = {
# 					add = 10
# 					primary_title.tier = tier_kingdom
# 				}
# 			}
# 			save_scope_as = revolter
# 		}

# 		# ordered_in_list = {
# 		# 	list = rebellious_targets
# 		# 	order_by = primary_title.tier
# 		# 	max = 1

# 		# 	save_scope_as = revolter
# 		# }
# 	}
# 	option = {
# 		random_list = {
# 			99 = {
# 				#No Revolt
# 			}
# 			1 = { #Revolt
# 				opinion_modifier = { #Weight up Opinion
# 					who = scope:revolter
# 					opinion_target = root
# 					multiplier = -1
# 				}
# 				ai_value_modifier = { #Weight up their Boldness
# 					who = scope:revolter
# 					ai_boldness = 1
# 				}
# 				ai_value_modifier = { #Weight up their Rationality
# 					who = scope:revolter
# 					ai_rationality = -0.5
# 				}
# 				scope:revolter = {
# 					start_war = {
# 						casus_belli = agot_independence_war
# 						target = root
# 					}
# 					#They declare themselves king - Fix once Megawars allows it
# 					#trigger_event = agot_proclamation_events.0001
# 				}
# 			}
# 		}
# 	}
# 	option = {

# 	}
# }

##################################################
# 5 Year Pulse - A King from the Hill Tribes Invades the Vale
# Badger
# 1003
##################################################

# agot_instability.1003 = {
# 	#hidden = yes
# 	theme = war
# 	orphan = yes
# 	trigger = {
# 		OR = {
# 			any_vassal_or_below = {
# 				primary_title = title:k_the_vale
# 			}
# 			#any_held_title = title:e_the_vale
# 		}
# 		is_at_war = no #For now to stop shit
# 	}

# 	left_portrait = {
# 		character = scope:hill_tribe_king
# 		animation = celebrate_axe
# 	}

# 	immediate = {
# 		random_sub_realm_county = {
# 			limit = {
# 				OR = {
# 					de_jure_liege = title:d_strongsong
# 					de_jure_liege = title:d_crowncrests
# 					de_jure_liege = title:d_the_giants_lance
# 					de_jure_liege = title:d_ninestars
# 					de_jure_liege = title:d_wickenden
# 					de_jure_liege = title:d_the_cut
# 				}
# 			}
# 			save_scope_as = invasion_location
# 		}
# 		scope:invasion_location.title_province = {
# 			save_scope_as = invasion_location_province
# 		}
# 		create_character = {
# 			template = hill_tribe_king_template
# 			save_scope_as = hill_tribe_king
# 			location = scope:invasion_location_province

# 			gender_female_chance = {
# 				if = {
# 					limit = { scope:hill_tribe_king.faith = { has_doctrine = doctrine_gender_male_dominated } }
# 					add = 0
# 				}
# 				else_if = {
# 					limit = { scope:hill_tribe_king.faith = { has_doctrine = doctrine_gender_female_dominated } }
# 					add = 100
# 				}
# 				else = {
# 					add = 50
# 				}
# 			}
# 		}
# 		create_dynamic_title = {
# 			tier = kingdom
# 			name = e_the_moonclans
# 		}
# 		create_title_and_vassal_change = {
# 			type = created
# 			save_scope_as = change
# 			add_claim_on_loss = no
# 		}
# 		scope:new_title = {
# 			set_capital_county = scope:invasion_location
# 			set_landless_title = yes
# 			set_destroy_on_succession = yes
# 			set_delete_on_destroy = yes
# 			set_no_automatic_claims = yes
# 			set_definitive_form = yes
# 			set_can_be_named_after_dynasty = no
# 			change_title_holder = {
# 				holder = scope:hill_tribe_king
# 				change = scope:change
# 			}
# 		}
# 		resolve_title_and_vassal_change = scope:change
# 	}

# 	option = {
# 		scope:hill_tribe_king = {
# 			# Spawn Levies
# 			start_war = { #Invade the Vale
# 				casus_belli = clan_invasion_war
# 				target = root
# 				target_title = title:k_the_vale
# 			}

# 			spawn_army = {
# 				levies = {
# 					value = 12000
# 				}
# 				location = scope:invasion_location_province
# 				war = scope:hill_tribe_king.invasion_war
# 				name = populist_faction_event_troops
# 			}
# 		}
# 	}

# 	option = {

# 	}
# }

##################################################
# Landed Blackfyres Invade Westeros
# Dylan
# 1100
##################################################
agot_instability.1100 = {
	hidden = yes

	trigger = {
		#Currently for the Iron Throne as it Stagnates due to its enormity
		primary_title = title:e_the_iron_throne
		is_at_war = no #For now to stop shit
		any_ruler = {
			is_adult = yes
			is_ai = yes
			is_imprisoned = no
			is_at_war = no
			house ?= {
				this = house:house_Blackfyre
				has_house_modifier = divided_dynasty_house_modifier # They should no longer invade if they've made up
			}
			NOR = {
				any_owned_story = {
					story_type = story_agot_ninepenny_kings
				}
				liege = title:e_the_iron_throne.holder
				root = { #Block Nonsensical Declarations
					OR = {
						is_allied_to = prev
						has_strong_hook = prev
						has_relation_lover = prev
						has_relation_friend = prev
						has_truce = prev
					}
				}
			}
		}
	}

	immediate = {
		every_ruler = {
			limit = {
				is_adult = yes
				is_ai = yes
				is_imprisoned = no
				is_at_war = no
				house ?= {
					this = house:house_Blackfyre
					has_house_modifier = divided_dynasty_house_modifier
				}
				NOR = {
					any_owned_story = {
						story_type = story_agot_ninepenny_kings
					}
					liege = title:e_the_iron_throne.holder
					root = { #Block Nonsensical Declarations
						OR = {
							is_allied_to = prev
							has_strong_hook = prev
							has_relation_lover = prev
							has_relation_friend = prev
							has_truce = prev
						}
					}
				}
			}
			add_to_list = potential_invaders
		}
		random_in_list = {
			list = potential_invaders
			weight = {
				base = 1
				#Weigh up for opinion/strength?
				modifier = {
					add = 10
					primary_title.tier = tier_kingdom
				}
				modifier = {
					add = 50
					is_house_head = yes
				}
				modifier = {
					add = current_military_strength
				}
			}
			save_scope_as = revolter
		}
		scope:revolter = {
			add_pressed_claim = title:e_the_iron_throne
			add_pressed_claim = title:k_the_crownlands
			add_pressed_claim = title:d_kings_landing
			add_pressed_claim = title:c_kings_landing
			add_pressed_claim = title:k_dragonstone
			add_pressed_claim = title:d_dragonstone
			add_pressed_claim = title:c_dragonstone
		}

		#Causes crashes if title target doesn't belong to holder and they choose different side in war
		if = {
			limit = {
				title:e_the_iron_throne.holder = title:k_the_crownlands.holder
			}
			title:k_the_crownlands = { save_scope_as = title_1 }
		}
		else = {
			title:e_the_iron_throne = { save_scope_as = title_1 }
		}
		if = {
			limit = {
				title:e_the_iron_throne.holder = title:d_kings_landing.holder
			}
			title:d_kings_landing = { save_scope_as = title_2 }
		}
		else = {
			title:e_the_iron_throne = { save_scope_as = title_2 }
		}
		if = {
			limit = {
				title:e_the_iron_throne.holder = title:c_kings_landing.holder
			}
			title:c_kings_landing = { save_scope_as = title_3 }
		}
		else = {
			title:e_the_iron_throne = { save_scope_as = title_3 }
		}
		if = {
			limit = {
				title:e_the_iron_throne.holder = title:k_dragonstone.holder
			}
			title:k_dragonstone = { save_scope_as = title_4 }
		}
		else = {
			title:e_the_iron_throne = { save_scope_as = title_4 }
		}
		if = {
			limit = {
				title:e_the_iron_throne.holder = title:d_dragonstone.holder
			}
			title:d_dragonstone = { save_scope_as = title_5 }
		}
		else = {
			title:e_the_iron_throne = { save_scope_as = title_5 }
		}
		if = {
			limit = {
				title:e_the_iron_throne.holder = title:c_dragonstone.holder
			}
			title:c_dragonstone = { save_scope_as = title_6 }
		}
		else = {
			title:e_the_iron_throne = { save_scope_as = title_6 }
		}

	}
	option = {
		random_list = {
			55 = {
				#No Revolt
			}
			45 = { #Revolt
				opinion_modifier = { #Weight up Opinion
					who = scope:revolter
					opinion_target = root
					multiplier = -0.5
				}
				ai_value_modifier = { #Weight up their Boldness
					who = scope:revolter
					ai_boldness = 1
				}
				ai_value_modifier = { #Weight up their Rationality
					who = scope:revolter
					ai_rationality = -0.5
				}
				modifier = {
					scope:revolter = {
						has_character_flag = current_dragon
					}
					add = {
						value = 1
						multiply = 2.5
					}
				}
				scope:revolter = {
					start_war = {
						casus_belli = claim_cb
						claimant = scope:revolter
						target = root
						target_title = title:e_the_iron_throne
						target_title = scope:title_1
						target_title = scope:title_2
						target_title = scope:title_3
						target_title = scope:title_4
						target_title = scope:title_5
						target_title = scope:title_6
					}
					# Spawn Special Troops
					if = {
						limit = {
							is_landed = yes
						}
						generate_golden_company_special_troops = { LOCATION = scope:revolter.capital_province ORIGIN = scope:revolter.capital_province ARMY_NAME = blackfyre_dynamic_revolt_army }
					}
					else = {
						generate_golden_company_special_troops = { LOCATION = scope:revolter.location ORIGIN = scope:revolter.location ARMY_NAME = blackfyre_dynamic_revolt_army }
					}
				}
			}
		}
	}
	after = {
		scope:revolter = {
			# Call in Golden Company
			if = {
				limit = {
					title:d_laamp_merc_golden_company.holder ?= {
						has_really_bad_opinion_of_root_trigger = no
						NOR = {
							is_allied_to =  title:e_the_iron_throne.holder
							has_strong_hook =  title:e_the_iron_throne.holder
							has_relation_friend =  title:e_the_iron_throne.holder
							has_truce =  title:e_the_iron_throne.holder
						}
					}
				}
				every_character_war = {
					limit = {
						primary_defender = title:e_the_iron_throne.holder
					}
					add_attacker = title:d_laamp_merc_golden_company.holder
				}
			}
		}
	}
}
