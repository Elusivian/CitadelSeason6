namespace = agot_events_generic

# Death event
agot_events_generic.0001 = {
	hidden = yes

	trigger = {
		is_alive = yes
	}

	immediate = {
		death = {
			death_reason = death_vanished
		}
	}
}

agot_events_generic.0002 = {
	type = letter_event
	opening = agot_events_generic.0002.t
	sender = scope:byz_emp
	desc = agot_events_generic.0002.desc_vassal

	trigger = {

	}

	immediate = {
		title:e_the_iron_throne.holder = {
			save_scope_as = byz_emp
		}
	}

	option = {
		name = agot_events_generic.0002.a
		scope:byz_emp = {
			add_opinion = {
				modifier = grateful_opinion
				target = root
				opinion = 30
			}
		}
	}

	option = {
		name = agot_events_generic.0002.b
		scope:byz_emp = {
			add_opinion = {
				modifier = angry_opinion
				target = root
				opinion = -30
			}
		}
	}
}

agot_events_generic.0003 = {
	hidden = yes

	immediate = {
		house_feud_start_effect = {
			# Feuding House Head
			ACTOR = root
			# Target House Head
			TARGET = scope:rival
			# Feud Reason
			REASON = inherited_rivalry
			# House Member attacker if relevant
			ATTACKER = scope:rival
			# House Member victim if relevant
			VICTIM = root.father
		}
	}
}

agot_events_generic.0004 = {
	hidden = yes

	immediate = {
		if = {
			limit = {
				AND = {
					any_child = {
						is_ruler = yes
					}
					any_child = {
						age < 16
					}
				}
				NOT = { has_trait = widowed }
				NOT = {
					any_spouse = { is_alive = yes }
				}
			}
			add_trait = widowed

			create_character_memory = {
				type = agot_widowed_memory

				participants = {
					dead_relation = scope:dead_character
				}
			}

		}
	}
}

agot_events_generic.0005 = {
	hidden = yes

	trigger = {
		religion = religion:faith_of_the_seven_religion
		is_ai = yes
		is_human = yes # Adding an additional fallback in case this is triggered elsewhere
	}

	immediate = {
		random_list = {
			10 = {
				modifier = {
					factor = 5
					has_trait = authoritative
				}
				modifier = {
					factor = 5
					has_trait = just
				}
				modifier = {
					factor = 5
					has_trait = honest
				}
				modifier = {
					factor = 5
					has_trait = gregarious
				}
				modifier = {
					factor = 5
					has_trait = ambitious
				}
				set_variable = {
					name = patron_god
					value = flag:the_father
				}
				add_character_modifier = patron_the_father_modifier
			}
			10 = {
				modifier = {
					factor = 5
					has_trait = compassionate
				}
				modifier = {
					factor = 5
					has_trait = forgiving
				}
				set_variable = {
					name = patron_god
					value = flag:the_mother
				}
				add_character_modifier = patron_the_mother_modifier
			}
			10 = {
				modifier = {
					factor = 5
					has_trait = brave
				}
				modifier = {
					factor = 5
					has_trait = wrathful
				}
				modifier = {
					factor = 5
					has_trait = arrogant
				}
				modifier = {
					factor = 5
					is_agot_knight_trigger = yes
				}
				modifier = {
					factor = 5
					has_trait = squire
				}
				set_variable = {
					name = patron_god
					value = flag:the_warrior
				}
				add_character_modifier = patron_the_warrior_modifier
			}
			10 = {
				modifier = {
					factor = 5
					has_trait = diligent
				}
				modifier = {
					factor = 5
					has_trait = stubborn
				}
				modifier = {
					factor = 5
					has_trait = temperate
				}
				set_variable = {
					name = patron_god
					value = flag:the_smith
				}
				add_character_modifier = patron_the_smith_modifier
			}
			10 = {
				modifier = {
					factor = 5
					has_trait = chaste
				}
				modifier = {
					factor = 5
					has_trait = generous
				}
				modifier = {
					factor = 5
					has_trait = impatient
				}
				modifier = {
					factor = 5
					has_trait = trusting
				}
				set_variable = {
					name = patron_god
					value = flag:the_maiden
				}
				add_character_modifier = patron_the_maiden_modifier
			}
			10 = {
				modifier = {
					factor = 5
					has_trait = patient
				}
				modifier = {
					factor = 5
					has_trait = craven
				}
				modifier = {
					factor = 5
					has_trait = content
				}
				modifier = {
					factor = 5
					has_trait = shy
				}
				modifier = {
					factor = 5
					has_trait = rude
				}
				set_variable = {
					name = patron_god
					value = flag:the_crone
				}
				add_character_modifier = patron_the_crone_modifier
			}
			10 = {
				modifier = {
					factor = 5
					has_trait = humble
				}
				modifier = {
					factor = 5
					has_trait = calm
				}
				modifier = {
					factor = 5
					has_trait = fickle
				}
				modifier = {
					factor = 5
					has_trait = vengeful
				}
				modifier = {
					factor = 5
					has_trait = deceitful
				}
				modifier = {
					factor = 5
					has_trait = paranoid
				}
				set_variable = {
					name = patron_god
					value = flag:the_stranger
				}
				add_character_modifier = patron_the_stranger_modifier
			}
		}
	}
}

agot_events_generic.0006 = {
	hidden = yes

	immediate = {
		remove_character_flag = bookmark_independent
	}
}


agot_events_generic.0007 = {
	hidden = yes

	trigger = {
		is_ai = yes
		NOT = { has_character_flag = has_scripted_appearance }
	}

	immediate = {
		random = {
			chance = {
				value = 0
				if = {
					limit = { has_trait = fashionable }
					add = 1
				}
				if = {
					limit = { has_trait = eccentric }
					add = 1
				}
				if = {
					limit = { culture = culture:andalosi }
					add = 60
				}
				else_if = {
					limit = { culture = culture:crownlander }
					add = 1
				}
				else_if = {
					limit = { culture = culture:honeywiner }
					add = 1
				}
				else_if = {
					limit = { culture = culture:harborman }
					add = 1
				}
				else_if = {
					limit = { culture = culture:braavosi }
					add = 70
				}
				else_if = {
					limit = { culture = culture:essarian }
					add = 40
				}
				else_if = {
					limit = { culture = culture:lorathi }
					add = 80
				}
				else_if = {
					limit = { culture = culture:hartalari }
					add = 90
				}
				else_if = {
					limit = { culture = culture:lyseni }
					add = 30
				}
				else_if = {
					limit = { culture = culture:myrish }
					add = 60
				}
				else_if = {
					limit = { culture = culture:tyroshi }
					add = 100
				}
				else_if = {
					limit = { culture = culture:volantene }
					add = 50
				}
				else_if = {
					limit = { culture = culture:ghiscari }
					add = 80
				}
				else_if = {
					limit = { culture = culture:hazdahni }
					add = 80
				}
				else_if = {
					limit = { culture = culture:shuzduni }
					add = 80
				}
				else_if = {
					limit = { culture = culture:astapori }
					add = 95
				}
				else_if = {
					limit = { culture = culture:meereenese }
					add = 85
				}
				else_if = {
					limit = { culture = culture:yunkish }
					add = 90
				}
				else_if = {
					limit = { culture = culture:qartheen }
					add = 25
				}
				else_if = {
					limit = { culture = culture:greenblood }
					add = 2
				}
				else_if = {
					limit = { culture = culture:salt_dornish }
					add = 1
				}
				else_if = {
					limit = { culture = culture:rhoynish }
					add = 15
				}
				else_if = {
					limit = { culture = culture:essosi_valyrian }
					add = 5
				}
				else_if = {
					limit = { culture = culture:mantaryan }
					add = 40
				}
				else_if = {
					limit = { culture = culture:tolosi }
					add = 65
				}
				else_if = {
					limit = { culture = culture:elyrian }
					add = 65
				}
				else_if = {
					limit = {
						culture = { has_cultural_pillar = heritage_ghiscari }
					}
					add = 80
				}
				else_if = {
					limit = {
						culture = { has_cultural_pillar = heritage_valyrian }
						NOT = {
							culture = culture:high_valyrian
							culture = culture:westerosi_valyrian
							culture = culture:norvoshi
						}
					}
					add = 30
				}
			}
			add_character_flag = can_dye_hair
			agot_random_hair_dye_effect = yes
		}
		if = {
			limit = { has_character_flag = can_dye_hair }
			trigger_event = {
				id = agot_events_generic.0008
				years = { 5 15 }
			}
		}
	}
}

agot_events_generic.0008 = {
	hidden = yes

	trigger = {
		is_ai = yes
		is_alive = yes
		NOT = { has_character_flag = has_scripted_appearance }
	}

	immediate = {
		agot_random_hair_dye_effect = yes
		trigger_event = {
			id = agot_events_generic.0008
			years = { 5 15 }
		}
	}
}

agot_events_generic.0009 = {
	hidden = yes

	trigger = {
		NOT = { has_trait = education_republican_knowledge }
		is_capable_adult = yes
		is_human = yes
		OR = {
			agot_republic_education_trigger = yes
			dynasty ?= { has_dynasty_perk = fp2_urbanism_legacy_2 }
		}
	}

	immediate = {
		random_list = {
			10 = {
				modifier = {
					factor = 10
					OR = {
						has_trait = lazy
						has_trait = intellect_bad
						intrigue < 10
						stewardship < 10
					}
				}
				modifier = {
					factor = 0.1
					OR = {
						has_trait = ambitious
						has_trait = diligent
						has_trait = intellect_good
						has_trait = shrewd
					}
				}
				add_trait =  education_republican_knowledge_1
			}
			70 = {
				modifier = {
					factor = 5
					OR = {
						has_trait = content
						has_trait = stubborn
						has_trait = humble
					}
				}
				add_trait = education_republican_knowledge_2
			}
			15 = {
				modifier = {
					factor = 5
					OR = {
						has_trait = ambitious
						has_trait = diligent
						has_trait = intellect_good
						has_trait = shrewd
						has_trait = deceitful
					}
				}
				add_trait = education_republican_knowledge_3
				}
			5 = {
				modifier = {
					factor = 5
					OR = {
						has_trait = ambitious
						has_trait = diligent
						has_trait = intellect_good
						has_trait = shrewd
						intrigue > 20
						stewardship > 20
					}
				}
				add_trait = education_republican_knowledge_4
			}
		}
	}
}

agot_events_generic.0010 = {	# Banish to Essos
	hidden = yes
	immediate = {
		random_county_in_region = {
			region = world_essos
			limit = {
				NOT = { holder = scope:actor }
			}
			title_province = {
				save_scope_as = exile_title
			}
			#holder = {
			#	add_visiting_courtier = scope:target
			#}
		}
		scope:target = {
			move_to_pool_at = scope:exile_title
		}
	}
}

agot_events_generic.0011 = {
	hidden = yes

	trigger = {
		is_alive = yes
	}

	immediate = {
		if = {
			limit = { has_focus = education_martial }
			agot_add_coming_of_age_martial_prowess_flag_effect = yes
		}
		else = {
			agot_add_coming_of_age_prowess_flag_effect = yes
		}

		agot_add_coming_of_age_republican_flag_effect = yes
	}
}

#Animations setup for Jedi
agot_events_generic.0012 = {
	hidden = yes

	trigger = {
		is_alive = yes
		is_human = yes
	}

	immediate = {
		random_list = {
			30 = { add_character_flag = swordshield_person } #More people are likely to take it by default
			10 = { add_character_flag = maceshield_person }
			10 = { 
				modifier = {
					add = 30
					culture  = {
						any_parent_culture_or_above = {
							OR = {
								this = culture:stone_dornish
								this = culture:salt_dornish
								this = culture:sand_dornish
							}
						}
					}
				}
				add_character_flag = spearshield_person 
			}
			10 = { add_character_flag = sword_person }
			10 = { 
				modifier = {
					add = 40
					culture  = {
						any_parent_culture_or_above = {
							this = culture:norvoshi
						}
					}
				}
				modifier = {
					add = 20
					culture  = {
						any_parent_culture_or_above = {
							OR = {
								this = culture:northman
								this = culture:barrowman
								this = culture:bearman
								this = culture:wolfswood_clansman
								this = culture:hill_clansman
								this = culture:krakenman
								this = culture:skagosi
							}
						}
					}
				}			
				add_character_flag = axe_person 
			}
			10 = { 
				modifier = {
					add = 30
					culture  = {
						any_parent_culture_or_above = {
							OR = {
								this = culture:stone_dornish
								this = culture:salt_dornish
								this = culture:sand_dornish
							}
						}
					}
				}
				add_character_flag = spear_person 
			}
			10 = { add_character_flag = mace_person }
			10 = { add_character_flag = hammer_person }
		}
	}
}

#Destined Child
agot_events_generic.0020 = {
	hidden = yes

	trigger = {
		has_bp2_dlc_trigger = yes
	}

	immediate = {
		add_character_modifier = {
			modifier = bp2_destined_modifier
		}
		set_variable = {
			name = destiny_child
			value = root
		}

		random_parent = {
			limit = {
				is_landed = yes
			}
			create_story = {
				type = story_destiny_child
				save_scope_as = story
			}

			random_owned_story = {
				limit = {
					story_type = story_destiny_child
				}
				set_variable = {
					name = destiny_child
					value = root
				}
			}
		}
	}
}